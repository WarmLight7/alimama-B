{
  "result_path": "./backup/judgeResult_${submitId}.json",
  "pre_steps": [
    {
      "name": "创建这个提交独立的日志文件夹",
      "command": "mkdir -p judge_log/${submitId}/"
    },
    {
      "name:": "清理文件",
      "command": "rm testbench/testbenchResult.json -rf"
    },
    {
      "name": "清理 docker",
      "command": "docker compose -f docker-compose.yml down --timeout 0 || true"
    },
    {
      "name": "清理 docker",
      "command": "docker volume prune -af"
    },
    {
      "name": "清理本地文件",
      "command": "rm node-1 node-2 node-3 node-testbench build -rf || true"
    },
    {
      "name": "解压代码",
      "command": "mkdir build && tar -xzf code.tar.gz --director=build",
      "errcode": 12,
      "timoutcode": 12
    },
    {
      "name": "编译阶段",
      "command": "docker run --rm  -v ./build:/work -w /work --network none public-images-registry-vpc.cn-hangzhou.cr.aliyuncs.com/demo/alimama-2023:B-v0 bash build.sh 2>judge_log/${submitId}/compile_err.log 1>judge_log/${submitId}/compile_std.log",
      "timeout": 300,
      "errcode": 12,
      "timoutcode": 12
    }
  ],
  "main_steps": [
    {
      "name": "给每个节点复制一个目录",
      "command": "for i in {1..3}; do cp -r build node-$i ;done"
    },
    {
      "name": "启动考生的服务",
      "command": "docker compose -f docker-compose.yml up -d"
    },
    {
      "name": "等待结果",
      "command": "sleep 3600",
      "wathpath": "testbench/testbenchResult.json",
      "parse_result": true
    }
  ],
  "post_steps": [
    {
      "name": "rm code.tar.gz",
      "command": "rm -f code.tar.gz"
    },
    {
      "name": "清理 docker(复赛题不给日志)",
      "command": "ls || for i in {1..3}; do docker logs node-$i -n 10000 >> judge_log/${submitId}/docker-node-$i.log 2>&1 || true ; done "
    },
    {
      "name": "testbench日志",
      "command": "docker logs node-testbench >> judge_log/${submitId}/testbench.log 2>&1 || true"
    },
    {
      "name": "清理 docker",
      "command": "docker compose -f docker-compose.yml down --timeout 0 || true "
    },
    {
      "name": "打包日志文件",
      "command": "tar -czvf ./backup/logs_${submitId}.tar.gz ./judge_log/${submitId}/* || true"
    }
  ]
}
